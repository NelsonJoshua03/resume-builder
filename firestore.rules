rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 1. JOBS COLLECTION - Public read, Admin write
    match /jobs/{jobId} {
      allow read: if true;  // Anyone can view job listings
      allow create: if request.auth != null;  // Only authenticated users can create
      allow update: if request.auth != null;  // Only authenticated users can update
      allow delete: if request.auth != null;  // Only authenticated users can delete
    }
    
    // 2. ANALYTICS EVENTS - Public write, Admin read
    match /events/{eventId} {
      allow read: if request.auth != null;  // Only authenticated users (admin) can read
      allow write: if true;  // Anyone can write events (for tracking)
    }
    
    // 3. PAGE VIEWS - Public write, Admin read
    match /pageViews/{viewId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 4. RESUME EVENTS - Public write, Admin read
    match /resumeEvents/{eventId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 5. JOB EVENTS - Public write, Admin read
    match /jobEvents/{eventId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 6. BLOG EVENTS - Public write, Admin read
    match /blogEvents/{eventId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 7. USER PROFILES - Users can read/write their own
    match /userProfiles/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 8. RESUMES - Users can read/write their own, public resumes can be read
    match /resumes/{resumeId} {
      allow read: if request.auth != null && request.auth.uid == resource.data.userId 
                 || resource.data.metadata.isPublic == true;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow update: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow delete: if request.auth != null && request.auth.uid == resource.data.userId;
    }
    
    // 9. DAILY ANALYTICS - Admin only
    match /dailyAnalytics/{date} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // 10. FUNNELS - Public write, Admin read
    match /funnels/{funnelId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 11. USER SESSIONS - Public write, Admin read
    match /userSessions/{sessionId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // 12. ERROR LOGS - Public write, Admin read
    match /errorLogs/{errorId} {
      allow read: if request.auth != null;
      allow write: if true;
    }
    
    // Default deny for any other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}